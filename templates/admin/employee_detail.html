{% extends "admin/base.html" %}

{% block page_title %}Detalhes do Funcionário{% endblock %}

{% block extra_css %}
{{ super() }}
<style>
    .employee-detail-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-bottom: 30px;
    }
    .employee-detail-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
    }
    .employee-detail-avatar {
        width: 90px;
        height: 90px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2.5rem;
        font-weight: 600;
        overflow: hidden;
        flex-shrink: 0;
    }
    .employee-detail-profile-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .employee-detail-info h2 {
        margin: 0;
        color: var(--dark-color);
    }
    .employee-detail-info p {
        margin: 5px 0 0;
        color: var(--secondary-color);
        font-size: 1rem;
    }
    .detail-item {
        margin-bottom: 15px;
    }
    .detail-item strong {
        color: var(--dark-color);
        display: block;
        margin-bottom: 5px;
    }
    .detail-item span {
        color: var(--secondary-color);
    }
    .form-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid #eee;
    }
    .form-section h4 {
        color: var(--primary-color);
        margin-bottom: 20px;
    }
    .btn-back {
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block admin_content %}
<div class="employee-detail-card">
    <div class="employee-detail-header">
        <div class="employee-detail-avatar">
            {% if employee.profile_picture %}
                <img src="{{ url_for("admin.serve_profile_picture", filename=employee.profile_picture) }}" 
                     alt="Foto de {{ employee.username }}" class="employee-detail-profile-image">
            {% else %}
                {{ employee.username[0].upper() }}
            {% endif %}
        </div>
        <div class="employee-detail-info">
            <h2>{{ employee.username }}</h2>
            <p>
                <i class="fas fa-user-tag me-1"></i>
                {% if employee.user_type == "admin" %}
                    Administrador
                {% else %}
                    Funcionário
                {% endif %}
                <span class="mx-2">|</span>
                <i class="fas fa-calendar-plus me-1"></i>
                Criado em {{ employee.created_at.strftime("%d/%m/%Y") }}
                <span class="mx-2">|</span>
                {% if employee.is_active %}
                    <span class="text-success"><i class="fas fa-check-circle me-1"></i>Ativo</span>
                {% else %}
                    <span class="text-danger"><i class="fas fa-times-circle me-1"></i>Inativo</span>
                {% endif %}
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="detail-item">
                <strong>ID do Usuário:</strong>
                <span>{{ employee.id }}</span>
            </div>
            <div class="detail-item">
                <strong>Nome de Usuário:</strong>
                <span>{{ employee.username }}</span>
            </div>
        </div>
        <div class="col-md-6">
            <div class="detail-item">
                <strong>Tipo de Usuário:</strong>
                <span>
                    {% if employee.user_type == "admin" %}
                        Administrador
                    {% else %}
                        Funcionário
                    {% endif %}
                </span>
            </div>
            <div class="detail-item">
                <strong>Status da Conta:</strong>
                <span>
                    {% if employee.is_active %}
                        Ativo
                    {% else %}
                        Inativo
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Formulário de Edição de Funcionário -->
    <div class="form-section">
        <h4><i class="fas fa-edit me-2"></i>Editar Informações do Funcionário</h4>
        <form method="POST" action="{{ url_for("admin.edit_employee", employee_id=employee.id) }}">
            <div class="mb-3">
                <label for="username" class="form-label">Nome de Usuário</label>
                <input type="text" class="form-control" id="username" name="username" value="{{ employee.username }}" required>
            </div>
            <div class="mb-3 form-check form-switch">
                <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if employee.is_active %}checked{% endif %}>
                <label class="form-check-label" for="is_active">Conta Ativa</label>
            </div>
            <div class="mb-3">
                <label for="user_type" class="form-label">Tipo de Usuário</label>
                <select class="form-select" id="user_type" name="user_type">
                    <option value="funcionario" {% if employee.user_type == "funcionario" %}selected{% endif %}>Funcionário</option>
                    <option value="admin" {% if employee.user_type == "admin" %}selected{% endif %}>Administrador</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Salvar Alterações</button>
        </form>
    </div>

    <!-- Formulário de Mudança de Senha -->
    <div class="form-section">
        <h4><i class="fas fa-key me-2"></i>Mudar Senha do Funcionário</h4>
        <form method="POST" action="{{ url_for("admin.change_employee_password", employee_id=employee.id) }}">
            <div class="mb-3">
                <label for="new_password" class="form-label">Nova Senha</label>
                <input type="password" class="form-control" id="new_password" name="new_password" required>
            </div>
            <div class="mb-3">
                <label for="confirm_password" class="form-label">Confirmar Nova Senha</label>
                <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
            </div>
            <button type="submit" class="btn btn-warning"><i class="fas fa-lock me-2"></i>Mudar Senha</button>
        </form>
    </div>

    <a href="{{ url_for("admin.employees") }}" class="btn btn-secondary btn-back">
        <i class="fas fa-arrow-left me-2"></i>Voltar para Lista de Usuários
    </a>
</div>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
    // Adicione scripts JS específicos para esta página, se necessário
</script>
{% endblock %}

